<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--Simple.css-->
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
    <title> test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <script src="https://kit.fontawesome.com/5135d630a7.js" crossorigin="anonymous"></script>
</head>

<style>
    /* Custom CSS */
    
     :root {
        --accent: #6e48ad;
        --accent-bg: white;
        --bg: #fff;
        --text: #212121;
        --text-light: #585858;
        --border: #d8dae1;
        --code: #d81b60;
        --preformatted: #444;
    }
    
    article {
        background-color: var(--marked);
        border: 1px solid var(--border);
        border-radius: 5px;
        padding: 1em;
        margin: 1em 0;
    }
    
    ul {
        list-style-type: none;
    }
    
    .center-class {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    article ul li {
        background-color: #c6df28;
        padding: 20px;
        border-radius: 3px;
        margin-top: 10px;
    }
    
    article ul li:last-child {
        margin-bottom: 35px;
    }
    
    article ul li h3 {
        margin: 0;
    }
    
    ul li a {
        text-decoration: none;
        color: var(--text);
    }
    
    u h2 {
        text-align: center;
    }
    
    h2,
    h4 {
        margin-top: 0;
    }
    
    hr {
        background: var(--accent);
        border-color: var(--accent);
    }
    
    button,
    a[role="button"] {
        color: #05502d;
        text-decoration: none;
        outline: #05502d solid 0.5px;
        margin-left: 5px;
        padding: 10px;
        border-radius: 5px;
    }
    
    input,
    select,
    textarea {
        width: 100%;
    }
    
    .list-title h1,
    .list-title h2 {
        text-align: center;
        margin-top: 10px;
        margin-bottom: 5px;
    }
    
    .list-title p {
        margin-left: 10px;
        padding: 10px 10px 10px 15px;
        background-color: #e6e6e6;
        border-radius: 5px;
    }
    
    .list-title span {
        font-weight: bold;
        text-transform: capitalize;
    }
    
    article h3 {
        margin: 8px;
    }
    
    .submit-button {
        color: #ffffff;
        text-decoration: none;
        margin-left: 5px;
        padding: 10px 25px;
        border-radius: 5px;
        font-size: 20px;
        margin: 10px auto;
        background-color: #320ae9;
        margin-left: 35%;
    }
    
    .list1 {
        background-color: #585858;
        padding: 8px;
        margin: 20px;
        font-size: 24px;
        cursor: pointer;
    }
    
    .list1 a {
        color: #f5e2e2;
        text-decoration: none;
    }
    
    li::marker {
        color: black;
    }
    
    .task {
        padding: 20px;
        margin: 15px;
        background-color: antiquewhite;
    }
    
    .task h3 {
        margin-top: 5px;
    }
    
    .task p {
        color: #8d8070;
    }
    
    .box {
        background-color: #e6e6e6;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
    }
    .notification {
            background-color: #0d6efd;
            color: white;
            text-decoration: none;
            padding: 4px 24px;
            margin-right: 20px;
            margin-left: 20px;
            position: relative;
            display: inline-block;
            border-radius: 2px;
            font-size: 20px;
        }

        .notification:hover {
            background: #0b5ed7;
            color: #fff;
        }

        .notification .badge {
            position: absolute;
            top: -10px;
            right: -10px;
            padding: 8px 8px;
            border-radius: 50%;
            background: red;
            color: white;
        }

        .notification-section .dropdown-toggle::after {
            content: none;
        }

        .dropdown-toggle::after {
            color: #fff;
        }

        #notifications-dropdown li {
            max-width: 500px;
            word-wrap: break-word;
            display: inline-block;
            white-space: normal;
        }

        #notifications-dropdown.dropdown-menu {
            width: 15rem;
        }
        .header{
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            
        }
        .navitem{
            margin: 10px; 
            padding: 10px;
             text-decoration: none;
              background-color: #e6e6e6;
               border-radius: 5px;
        }
        #navbarDropdown:hover + #notifications-dropdown{
            display: block;
        }
        #notifications-dropdown:hover{
            display: block;
        }
</style>


<body>{% if user.is_superuser %}
    <p>Admin: {{user.username}}</p>{% else %}
    <p>User: {{user.username}}</p>{% endif %} {% if user.is_authenticated %}
    <a href="">Log out</a> {% else %}
    <a href="">Log in</a> <a href="" class="">Register</a>{% endif %}

    <header>{% if user.is_authenticated  %}
        <h1>Test</h1>
        <div class="header">
        {% if user.is_superuser %}
        <a class="navitem" href="">All Tasks</a>
        <a  class="navitem" href="">Your req </a> {% else %}
        <a class="navitem" href="">All Tasks</a> {% endif %} {% if not user.is_superuser %}
        <a class="navitem" href="" > Change request ({{num}}) </a>{% endif %}
       
        <li class="nav-item dropdown notification-section">

            <a href="#" class="notification dropdown-toggle" id="navbarDropdown" role="button"
                data-bs-toggle="dropdown" aria-expanded="true">
                <span><i class='fa fa-bell'></i></span>
                <span class="badge" id="notification-badge">0</span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="notifications-dropdown"
                data-popper-placement="bottom-end"
                style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(-70px, 42px, 0px);">
                {% for i in notifications %}  
                <li class="dropdown-item">{{i.message}}</li>
                <hr class="dropdown-divider">
                {% endfor %}
                {% comment %} <li class='dropdown-item'>Hello</li>
                <hr class="dropdown-divider"> {% endcomment %}
                
            </ul>
        </li>
        <div class="flex-shrink-0 dropdown" style="margin-right: 20px">
            <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle show" id="dropdownUser2"
                data-bs-toggle="dropdown" aria-expanded="true">
                <img src="https://avatars.githubusercontent.com/u/46575019?v=4" alt="mdo" width="50" height="50"
                    class="rounded-circle">
            </a>
            <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2"
                data-popper-placement="bottom-end"
                style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(-110px, 50px, 0px);">
                <li><a class="dropdown-item" href="#">New project...</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
                <li><a class="dropdown-item" href="#">Profile</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="#">Sign out</a></li>
            </ul>
        </div>
    </div>
    </header>
    {% endif %}
    <main>
        {% block content %}

        <p> content
        </p>
        {% endblock content %}
    </main>
    {{ room_name|json_script:"room-name" }}
    <p id="room-name" >{{room_name|json_script}}</p>
    <script>
 const roomName = JSON.parse(document.getElementById('room-name').textContent);
     console.log(roomName)
        const notificationSocket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/notification/'
            + roomName
            + '/'
        );
        
        console.log(notificationSocket)
        console.log("hhh")
        notificationSocket.onmessage = function(e) {
            console.log('sueeee')
            const data = JSON.parse(e.data);
            //document.querySelector('#chat-log').value += (data.message + '\n');
            console.log(data);
            console.log(data.message);
            document.getElementById("notifications-dropdown").innerHTML = "<li class='dropdown-item'>" + data.message + "</li><hr class='dropdown-divider'>" 
                                                                            + document.getElementById("notifications-dropdown").innerHTML;
            document.getElementById("notification-badge").innerHTML = parseInt(document.getElementById("notification-badge").innerHTML) + 1;
        };

        notificationSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        // document.querySelector('#chat-message-input').focus();
        // document.querySelector('#chat-message-input').onkeyup = function(e) {
        //     if (e.keyCode === 13) {  // enter, return
        //         document.querySelector('#chat-message-submit').click();
        //     }
        // };

        // document.querySelector('#chat-message-submit').onclick = function(e) {
        //     const messageInputDom = document.querySelector('#chat-message-input');
        //     const message = messageInputDom.value;
        //     chatSocket.send(JSON.stringify({
        //         'message': message
        //     }));
        //     messageInputDom.value = '';
        // };
        let notification_icon = document.getElementById('navbarDropdown')
        
    </script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js">
</script>


<!-- JavaScript to handle the Ajax request -->


</body>

</html>